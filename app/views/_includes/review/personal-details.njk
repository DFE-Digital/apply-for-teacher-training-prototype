{% set applicationPath = "/application/" + applicationId %}

{% set nameText %}
  {% if applicationValue(["candidate", "given-name"]) or applicationValue(["candidate", "family-name"]) %}
    {{ applicationValue(["candidate", "given-name"]) }} {{ applicationValue(["candidate", "family-name"]) }}
  {% else %}
    Not entered
  {% endif %}
{% endset %}

{% set dateOfBirthText %}
  {% if applicationValue(["candidate", "date-of-birth"]) %}
    {% set day = applicationValue(["candidate", "date-of-birth", "day"]).padStart(2, '0') %}
    {% set month = applicationValue(["candidate", "date-of-birth", "month"]).padStart(2, '0') %}
    {% set year = applicationValue(["candidate", "date-of-birth", "year"]) %}
    {{ (year + "-" + month + "-" + day) | date("d MMMM yyyy") }}
  {% else %}
    Not entered
  {% endif %}
{% endset %}

{% set nationalityText =
  applicationValue(["candidate", "multiple-nationalities"])
  or applicationValue(["candidate", "other-nationality"])
  or applicationValue(["candidate", "nationality"])
  or "Not entered"
%}

{% set residency = applicationValue(["candidate", "residency"]) %}

{% set residencyText %}
  <p class="govuk-body">{{ applicationValue(["candidate", "residency"]) }}</p>
  {% if applicationValue(["candidate", "residency-right-to-work"]) %}
    {%- if applicationValue(["candidate", "residency"]) == "Yes – I have the right to work or study in the UK" -%}
      <p class="govuk-body">{{ applicationValue(["candidate", "residency-right-to-work"]) | nl2br }}</p>
    {% endif %}
  {% endif %}
{% endset %}

{% set proficiencyText %}
  <p class="govuk-body">{{ applicationValue(["candidate", "english-proficiency"]) }}</p>
  {% if applicationValue(["candidate", "english-proficiency-fluent"]) or applicationValue(["candidate", "english-proficiency-professional"]) %}
    {%- if applicationValue(["candidate", "english-proficiency"]) == "I can participate in any conversation easily" -%}
      <p class="govuk-body">{{ applicationValue(["candidate", "english-proficiency-professional"]) | nl2br }}</p>
    {%- elif applicationValue(["candidate", "english-proficiency"]) == "I’m completely fluent" -%}
      <p class="govuk-body">{{ applicationValue(["candidate", "english-proficiency-fluent"]) | nl2br }}
    {%- endif %}
  {% endif %}
{% endset %}

{% set personalDetailsHtml %}
  {{ govukSummaryList({
    rows: [{
      key: {
        text: "Name"
      },
      value: {
        text: nameText
      },
      actions: {
        items: [{
          href: applicationPath + "/personal-details?referrer=" + referrer,
          text: "Change",
          visuallyHiddenText: "name"
        }]
      } if canAmend
    }, {
      key: {
        text: "Date of birth"
      },
      value: {
        text: dateOfBirthText
      },
      actions: {
        items: [{
          href: applicationPath + "/personal-details?referrer=" + referrer,
          text: "Change",
          visuallyHiddenText: "date of birth"
        }]
      } if canAmend
    }, {
      key: {
        text: "Nationality"
      },
      value: {
        html: nationalityText
      },
      actions: {
        items: [{
          href: applicationPath + "/personal-details/nationality?referrer=" + referrer,
          text: "Change",
          visuallyHiddenText: "nationality"
        }]
      } if canAmend
    }, {
      key: {
        text: "Residency status"
      },
      value: {
        html: residencyText
      },
      actions: {
        items: [{
          href: applicationPath + "/personal-details/residency?referrer=" + referrer,
          text: "Change",
          visuallyHiddenText: "residency status"
        }]
      } if canAmend
    } if residency, {
      key: {
        text: "Proficiency in English"
      },
      value: {
        html: proficiencyText
      },
      actions: {
        items: [{
          href: applicationPath + "/personal-details/english-proficiency?referrer=" + referrer,
          text: "Change",
          visuallyHiddenText: "proficiency in English"
        }]
      } if canAmend
    } if residency]
  }) }}
{% endset %}

{% set complete = "true" if applicationValue(["completed", "personal-details"]) %}

{% if showIncomplete and complete != "true" %}
  {% set incompleteType = "warning" if errorList %}
  {% set incompleteId = "candidate" %}
  {% set incompleteText = "Personal details are not marked as completed" %}
  {% set incompleteLink = "/personal-details/review?referrer=" + referrer %}
  {% include "_includes/review/incomplete.njk" %}
{% else %}
  {{ appSummaryCard({
    classes: "govuk-!-margin-bottom-6",
    html: personalDetailsHtml
  }) }}
{% endif %}
