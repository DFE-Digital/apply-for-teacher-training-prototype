{% extends "_content.njk" %}
{% set applicationPath = "/application/" + applicationId %}
{% set status = applicationValue(["status"]) %}
{% set incompleteTagClass = "govuk-tag--grey" %}
{% set incompleteTagText = "Incomplete" %}
{% set notStartedTagClass = "govuk-tag--grey" %}
{% set notStartedTagText = "Not started" %}
{% set referrer = applicationPath %}
{% set international = applicationValue(["candidate", "other-nationality"]) or applicationValue(["candidate", "multiple-nationalities"]) %}

{% if status == "started" %}
  {% if applicationValue('apply2') %}
    {% set title = "Your new application" %}
  {% else %}
    {% set title = "Your application" %}
  {% endif %}
  {% set tagText = "Completed" %}
  {% set reviewText = "Check your answers before submitting" %}
{% elif status == "amending" %}
  {% set title = "Edit your application" %}
  {% set tagClass = "app-tag--grey" %}
  {% set tagText = "Unedited" %}
  {% set reviewText = "Check your changes before submitting" %}
{% endif %}
{% set hasSecondary = true %}

{% block beforePageTitle %}
  {% if showCopiedBanner %}
    {{ appBanner({
      html: "<h2 class=\"govuk-heading-m\">We’ve copied your application. Please review all sections.</h2>",
      type: "success",
      icon: false
    }) }}
  {% endif %}
{% endblock %}

{% block pageNavigation %}
  {% if hasSubmittedApplications() %}
    {{ govukBreadcrumbs({
      items: [{
        text: "Application dashboard",
        href: "/applications" + ("?phase=amend" if status == "amending")
      }, {
        text: title | safe
      }]
    }) }}
  {% endif %}
{% endblock %}

{% block beforePrimary %}
  <h1 class="govuk-heading-xl govuk-!-margin-bottom-2">{{ title | safe }}</h1>
  <p class="govuk-hint govuk-!-margin-bottom-8">Last saved on {{ "now" | date("d MMMM yyyy") }} at {{ "now" | date("t") }}</p>

{% endblock %}

{% block primary %}
  {{ govukWarningText({
    text: "You have 5 days remaining (until " + (7 | nowPlusDays("d MMMM yyyy")) + ") to submit your edited application",
    iconFallbackText: "Warning"
  }) if status == "amending" }}

  {% set rejectionHtml %}
    <section class="app-summary-card govuk-!-margin-bottom-6">
      <header class="app-summary-card__header">
        <h3 class="app-summary-card__title">Gorse SCITT</h3>
      </header>
      <div class="app-summary-card__body">
        <dl class="govuk-summary-list">
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Course
            </dt>
            <dd class="govuk-summary-list__value">
              <a href="https://find-postgraduate-teacher-training.education.gov.uk/course/1N1/2XT2">Primary
                (2XT2)</a><br>PGCE with QTS full time
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Reasons for rejection
            </dt>
            <dd class="govuk-summary-list__value">
              Lack of knowledge of the purpose of PE in schools and the content of the secondary PE curriculum Lack of
              understanding of the procedures / processes related to safeguarding.
            </dd>
          </div>
        </dl>
      </div>
    </section>

    <section class="app-summary-card govuk-!-margin-bottom-6">
      <header class="app-summary-card__header">
        <h3 class="app-summary-card__title">Leeds Trinity University</h3>
      </header>
      <div class="app-summary-card__body">
        <dl class="govuk-summary-list">
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Course
            </dt>
            <dd class="govuk-summary-list__value">
              <a href="https://find-postgraduate-teacher-training.education.gov.uk/course/L24/2VLT">Primary (3-7)
                (2VLT)</a><br>PGCE with QTS full time
            </dd>
          </div>

          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Reasons for rejection
            </dt>
            <dd class="govuk-summary-list__value">
              Unfortunately due to the volume of applications we have received for our PE programme and the limited
              placement opportunities remaining we will be unable to take forward your application at this time.
            </dd>
          </div>
        </dl>
      </div>
    </section>

    <section class="app-summary-card govuk-!-margin-bottom-0">
      <header class="app-summary-card__header">
        <h3 class="app-summary-card__title">Bradford College</h3>
      </header>
      <div class="app-summary-card__body">
        <dl class="govuk-summary-list">
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Course
            </dt>
            <dd class="govuk-summary-list__value">
              <a href="https://find-postgraduate-teacher-training.education.gov.uk/course/B60/X100">Primary
                (X100)</a><br>PGCE with QTS full time
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Reasons for rejection
            </dt>
            <dd class="govuk-summary-list__value">
              As per our email communication, you did not have enough English in your profile to be considered for
              English and neither did you have GCSE's in English, Maths and Science to be considered for Primary.
            </dd>
          </div>
        </dl>
      </div>
    </section>
  {% endset %}

  {% if applicationValue(["apply2"]) %}
    {{ govukDetails({
      summaryText: "See feedback from your previous application",
      html: rejectionHtml
    }) }}
  {% endif %}

  {% if applicationValue(["apply2"]) %}
    <h2 class="govuk-heading-m govuk-!-font-size-27 govuk-!-margin-bottom-2">Course choice</h2>
  {% else %}
    <h2 class="govuk-heading-m govuk-!-font-size-27 govuk-!-margin-bottom-2">Course choices</h2>
  {% endif %}

  {% if applicationValue(["apply2"]) %}
    {% if applicationValue(["completed", "choices"]) %}
      {% set choiceTagText = tagText %}
      {% set choiceTagClass = tagClass %}
    {% else %}
      {% set choiceTagText = notStartedTagText%}
      {% set choiceTagClass = notStartedTagClass %}
    {% endif %}
  {% else %}
    {% if applicationValue(["completed", "choices"]) %}
      {% set choiceTagText = tagText %}
    {% else %}
      {% set choiceTagText = incompleteTagText %}
      {% set choiceTagClass = incompleteTagClass %}
    {% endif %}
  {% endif %}

  {{ appTaskList({
    classes: "govuk-!-margin-bottom-8",
    items: [{
      text: "Course choice" if applicationValue(["apply2"]) else "Course choices",
      href: applicationPath + "/choices",
      id: "personal-details",
      tag: {
        classes: choiceTagClass,
        text: choiceTagText
      }
    }]
  }) }}

  <h2 class="govuk-heading-m govuk-!-font-size-27 govuk-!-margin-top-4">About you</h2>
  {{ appTaskList({
    classes: "govuk-!-margin-bottom-8",
    items: [{
      text: "Personal details",
      href: applicationPath + "/personal-details" + ("/review" if applicationValue(["candidate"]) | length > 0),
      id: "personal-details",
      tag: {
        classes: tagClass if applicationValue(["completed", "personal-details"]) else incompleteTagClass,
        text: tagText if applicationValue(["completed", "personal-details"]) else incompleteTagText
      }
    }, {
      text: "Contact details",
      href: applicationPath + "/contact-details" + ("/review" if applicationValue(["contact-details", "address"])),
      id: "contact-details",
      tag: {
        classes: tagClass if applicationValue(["completed", "contact-details"]) else incompleteTagClass,
        text: tagText if applicationValue(["completed", "contact-details"]) else incompleteTagText
      }
    }, {
      text: "Work history",
      href: applicationPath + "/work-history" + ("/review" if applicationValue("work-history") | length > 0),
      id: "work-history",
      tag: {
        classes: tagClass if applicationValue(["completed", "work-history"]) else incompleteTagClass,
        text: tagText if applicationValue(["completed", "work-history"]) else incompleteTagText
      }
    }, {
      text: "Unpaid experience and volunteering",
      href: applicationPath + "/school-experience" + ("/review" if applicationValue("school-experience") | length > 0),
      id: "school-experience",
      tag: {
        classes: tagClass if applicationValue(["completed", "school-experience"]) else incompleteTagClass,
        text: tagText if applicationValue(["completed", "school-experience"]) else incompleteTagText
      }
    }, {
     text: "Asking for support if you have a disability",
     href: applicationPath + "/reasonable-adjustments" + ("/review" if applicationValue("reasonable-adjustments") | length > 0),
     id: "reasonable-adjustments",
     tag: {
        classes: tagClass if applicationValue(["completed", "reasonable-adjustments"]) else incompleteTagClass,
        text: tagText if applicationValue(["completed", "reasonable-adjustments"]) else incompleteTagText
     }
   }, {
    text: "Declaring any safeguarding issues",
    href: applicationPath + "/suitability" + ("/review" if applicationValue("suitability") | length > 0),
    id: "suitability",
    tag: {
      classes: tagClass if applicationValue(["completed", "suitability"]) else incompleteTagClass,
      text: tagText if applicationValue(["completed", "suitability"]) else incompleteTagText
    }
  }]
  }) }}

  <h2 class="govuk-heading-m govuk-!-font-size-27 govuk-!-margin-bottom-2">Qualifications</h2>
  {{ appTaskList({
    classes: "govuk-!-margin-bottom-8",
    items: [{
      text: "Degree",
      href: applicationPath + "/degree" + ("/review" if applicationValue(["degree"]) | length > 0 else "/add"),
      id: "degree",
      tag: {
        classes: tagClass if applicationValue(["completed", "degree"]) else incompleteTagClass,
        text: tagText if applicationValue(["completed", "degree"]) else incompleteTagText
      }
    }, {
      text: "Maths GCSE or equivalent",
      href: applicationPath + "/gcse/maths" + ("/review" if applicationValue(["gcse", "maths"]) | length > 0),
      id: "maths-gcse",
      tag: {
        classes: tagClass if applicationValue(["completed", "maths"]) else incompleteTagClass,
        text: tagText if applicationValue(["completed", "maths"]) else incompleteTagText
      }
    }, {
      text: "English GCSE or equivalent",
      href: applicationPath + "/gcse/english" + ("/review" if applicationValue(["gcse", "english"]) | length > 0),
      id: "english-gcse",
      tag: {
        classes: tagClass if applicationValue(["completed", "english"]) else incompleteTagClass,
        text: tagText if applicationValue(["completed", "english"]) else incompleteTagText
      }
    }, {
      text: "Science GCSE or equivalent",
      href: applicationPath + "/gcse/science" + ("/review" if applicationValue(["gcse", "science"]) | length > 0),
      id: "science-gcse",
      tag: {
        classes: tagClass if applicationValue(["completed", "science"]) else incompleteTagClass,
        text: tagText if applicationValue(["completed", "science"]) else incompleteTagText
      }
    } if hasPrimaryChoices() or applicationValue(["gcse", "science"]), {
      text: "Academic and other relevant qualifications",
      href: applicationPath + "/other-qualifications" + ("/review" if applicationValue(["other-qualifications"]) | length > 0 else "/add"),
      id: "other-qualifications",
      tag: {
        classes: tagClass if applicationValue(["completed", "other-qualifications"]) | length > 0 else incompleteTagClass,
        text: tagText if applicationValue(["completed", "other-qualifications"]) |length > 0 else incompleteTagText
      }
    }, {
      text: "English language qualifications",
      href: applicationPath + "/english-language" + ("/review" if applicationValue(["english-language"]) | length > 0 else "/add"),
      id: "english-language",
      tag: {
        classes: tagClass if applicationValue(["completed", "english-language"]) | length > 0 else incompleteTagClass,
        text: tagText if applicationValue(["completed", "english-language"]) |length > 0 else incompleteTagText
      }
    } if international]
  }) }}

  <h2 class="govuk-heading-m govuk-!-font-size-27 govuk-!-margin-bottom-2">Personal statement</h2>
  {{ appTaskList({
    classes: "govuk-!-margin-bottom-8",
    items: [{
      text: "Why do you want to be a teacher?",
      href: applicationPath + "/personal-statement" + ("/review" if applicationValue(["personal-statement"]) | length > 0),
      id: "personal-statement",
      tag: {
        classes: tagClass if applicationValue(["completed", "personal-statement"]) | length > 0 else incompleteTagClass,
        text: tagText if applicationValue(["completed", "personal-statement"]) |length > 0 else incompleteTagText
      }
    }, {
      text: "Your knowledge about the subject you want to teach",
      href: applicationPath + "/subject-knowledge" + ("/review" if applicationValue(["subject-knowledge"]) | length > 0),
      id: "subject-knowledge",
      tag: {
        classes: tagClass if applicationValue(["completed", "subject-knowledge"]) | length > 0 else incompleteTagClass,
        text: tagText if applicationValue(["completed", "subject-knowledge"]) |length > 0 else incompleteTagText
      }
    }, {
      text: "Interview needs",
      href: applicationPath + "/interview" + ("/review" if applicationValue(["interview"]) | length > 0),
      id: "interview",
      tag: {
        classes: tagClass if applicationValue(["completed", "interview"]) | length > 0 else incompleteTagClass,
        text: tagText if applicationValue(["completed", "interview"]) |length > 0 else incompleteTagText
      }
    } if data.flags.interview_preferences == true]
  }) }}

  <h2 class="govuk-heading-m govuk-!-font-size-27">References</h2>
  {% if status == "amending" %}
    <p class="govuk-body">You can’t change your choice of referees after you’ve submitted your application.</p>
  {% endif %}


  {# classes: "app-tag--" + ("completed" if status == "started" else ("submitted" if status == "amending")),
  text: "Completed" if status == "started" else ("Submitted" if status == "amending")


  if applicationValue(["referees"]) | length > 0 else {
        classes: incompleteTagClass,
        text: incompleteTagText
      }
  #}

  {% if applicationValue(["referees"]) | length > 0 %}
    {% set referencesUrl = applicationPath + "/references/review" %}
  {% else %}
    {% set referencesUrl = applicationPath + "/references/type/first" %}
  {% endif %}

  {{ appTaskList({
    classes: "govuk-!-margin-bottom-8",
    items: [{
      text: "Referees",
      href: referencesUrl,
      id: "references",
      tag: {
        classes: tagClass if applicationValue(["completed", "references"]) | length > 0 else incompleteTagClass,
        text: tagText if applicationValue(["completed", "references"]) |length > 0 else incompleteTagText
      }
    }]
  }) }}

  <h2 class="govuk-heading-m govuk-!-font-size-27">Check and submit</h2>

  {{govukButton({
    text: "Check and submit your application",
    href: applicationPath + "/review"
  })}}

{% endblock %}

{% block secondary %}
  {% include "_includes/need-help.njk" %}
{% endblock %}
