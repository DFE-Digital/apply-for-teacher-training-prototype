{% extends "_form.njk" %}

{% set applicationPath = "/application/" + applicationId %}
{% set formaction = applicationPath %}


{% set allowsFeedback = true %}
{% set referrer = applicationPath + "/references/review" %}
{% set references = applicationValue(["references"]) | toArray %}
{% set pendingReferences = references | selectattr("pending") | reverse %}
{% set readyReferences = references | selectattr("ready") | reverse %}
{% set otherReferences = references | rejectattr("pending") | rejectattr("ready") | reverse %}
{% set showReferenceRequestLog = true %}

{% if references | length > 0 %}
  {% set title = "References" %}
{% else %}
  {% set title = "What your referees are asked to do when you request a reference" %}
{% endif %}



{% block pageNavigation %}
  {{ govukBackLink({
    href: "/application/" + applicationId,
    text: "Back to application"
  }) }}
{% endblock %}

{% block beforePageTitle %}
  {{ govukNotificationBanner({
    text: messages[0],
    type: "success"
  }) if messages.length > 0 }}
{% endblock %}

{% set guidanceHtml %}
  <p class="govuk-body">Your referees will receive an email from the Department for Education.</p>

  <p class="govuk-body">We’ll ask them to use an online form to give their reference, as references sent by email are not accepted.</p>

  <p class="govuk-body">The form asks referees to write up to 500 words about your potential to teach. It says that they could talk about your:</p>

  <ul class="govuk-list govuk-list--bullet">
    <li>academic skills</li>
    <li>communication skills</li>
    <li>reliability and professionalism</li>
    <li>ability to work with children</li>
    <li>transferable skills</li>
  </ul>

  <p class="govuk-body">They’ll also need to:</p>

    <ul class="govuk-list govuk-list--bullet">
      <li>confirm how they know you</li>
      <li>say whether they know of any reason why you should not work with children</li>
    </ul>

  <p class="govuk-body">We’ll ask them to give your reference as soon as they can so that your application is not delayed.</p>

  <p class="govuk-body">Referees cannot see the content of your application.</p>

  <p class="govuk-body">It's a good idea to contact referees before requesting a reference so that they know what to expect.</p>

{% endset %}

{% block primary %}
  {% if references | length == 1 %}
    <div class="govuk-inset-text govuk-!-margin-top-0">
      <p class="govuk-body">You need to get 2 references back before you can submit your application.</p>
      {{ govukButton({
        text: "Request a second reference",
        href: "/application/" + applicationId + "/references/add?referrer=" + referrer
      }) }}
    </div>

    {{ govukDetails({
      summaryHtml: "What your referees are asked to do when you request a reference",
      html: guidanceHtml
    }) }}

  {% elif references | length > 1 %}
    <div class="govuk-inset-text govuk-!-margin-top-0">
      <p class="govuk-body">You can request as many references as you like but you can only submit 2 with your application.</p>
      {{ govukButton({
        classes: "govuk-button--secondary",
        text: "Request another reference",
        href: "/application/" + applicationId + "/references/add?referrer=" + referrer
      }) }}
    </div>

    {{ govukDetails({
      summaryHtml: "What your referees are asked to do when you request a reference",
      html: guidanceHtml
    }) }}
  {% else %}
    {{ guidanceHtml | safe}}

    {{ govukButton({
      text: "Add reference",
      href: "/application/" + applicationId + "/references/add"
    }) }}
  {% endif %}


  {% if readyReferences.length %}
    <h2 class="govuk-heading-m">References that have been given</h2>
    {% set references = readyReferences %}
    {% include "_includes/review/references.njk" %}
  {% endif %}

  {% if pendingReferences.length %}
    <h2 class="govuk-heading-m">Requests waiting to be sent</h2>
    {% set references = pendingReferences %}
    {% include "_includes/review/references.njk" %}
  {% endif %}

  {% if otherReferences.length %}
    <h2 class="govuk-heading-m">Reference requests</h2>
    {% set references = otherReferences %}
    {% include "_includes/review/references.njk" %}
  {% endif %}

{% endblock %}
