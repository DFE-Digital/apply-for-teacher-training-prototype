{% extends "_content.njk" %}

{% set title = "Application dashboard" %}
{% set hasSecondary = true %}
{% set referrer = "/applications&phase=" + phase %}
{% set applications = applications or data.applications %}
{% set applicationId = "" %}
{% set application = "" %}
{% if not phase %}
  {% set phase = "submitted" %}
{% endif %}
{% for key, value in applications %}
  {% set applicationId = key %}
  {% set application = value %}
  {% if not phase %}
    {% set phase = "submitted" %}
  {% endif %}
{% endfor %}

{% block beforePrimary %}
  <h1 class="govuk-heading-xl govuk-!-margin-bottom-2">{{ title | safe }}</h1>
  <p class="govuk-hint govuk-!-margin-bottom-8">Application submitted on {{ "now" | date("d MMMM yyyy") }}. <a href="/application/{{ applicationId }}/submitted?phase={{ phase }}">View application</a></p>
{% endblock %}

{% block primary %}
  {% set applicationPath = "/application/" + applicationId %}
  {% set canWithdraw = application.status != "submitted" %}
  {% set canMakeDecision = (phase == "decision") or (phase == "dbd") %}
  {% set showChoiceStatus = true %}

  <h2 class="govuk-heading-m govuk-!-font-size-27">
  {% if phase == "decision" %}
    Some of your training providers haven't reached a decision yet</h2>
  {% elif phase == "dbd" %}
    All your training providers have now reached a decision
  {% elif phase == "completed" %}
    You have accepted an offer
  {% else %}
    Courses you’ve applied to
  {% endif %}
  </h2>

  {# Guidance about making a decision #}
  {% if phase != "dbd" and phase != "completed" %}
    <p class="govuk-body">Training providers must respond by {{ 56 | nowPlusDays("d MMMM yyyy") }}.</p>
  {% endif %}
  {% if canMakeDecision and phase == "decision" %}
    <p class="govuk-body">If you accept an offer now, your remaining applications will be withdrawn.</p>
  {% elif canMakeDecision and phase == "dbd" %}
    <p class="govuk-body">You have 12 days (until {{ 12 | nowPlusDays("d MMMM yyyy") }}) to respond to any offers. If you don’t respond, your applications will be automatically withdrawn.</p>
  {% endif %}

  {# Guidance about steps after accepting an offer #}
  {% if phase == "completed" %}
    <p class="govuk-body">We've sent you an email to confirm this. Your training provider will be in touch with you direct to explain what happens next.</p>
  {% endif %}

  {% set choices = application.choices | toArray %}
  {% include "_includes/review/choices.njk" %}

  {% if data.flags.self_amend_contact_details %}
    {# Contact details #}
    <h2 class="govuk-heading-m govuk-!-font-size-27 govuk-!-margin-top-8">Contact details</h2>
    <p class="govuk-body">You can update your contact details at any point during the application process.</p>
    {% set contactDetails = application["contact-details"] %}
    {% set canAmend = true %}
    {% include "_includes/review/contact-details.njk" %}
  {% endif %}
{% endblock %}

{% block secondary %}
  {% include "_includes/need-help.njk" %}
  {% if not data.flags.self_amend_contact_details %}
    {{ appRelated({
      title: "Updating your contact details",
      content: {
        html: "You can update your contact details at any point during the application process. To do this, email us at <a href=\"mailto:becomingateacher@digital.education.gov.uk\">becomingateacher<wbr>@digital.education.gov.uk</a>."
      }
    }) }}
  {% endif %}
{% endblock %}
